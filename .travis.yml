language: perl
perl:
  - 5.19
before_install:
  - pwd
  - ls -la
  - export nanomsgver=0.1-alpha
  - export nanomsgbuild=`mktemp -d`
  - cd $nanomsgbuild
  - wget http://download.nanomsg.org/nanomsg-${nanomsgver}.tar.gz
  - tar xfz nanomsg-${nanomsgver}.tar.gz
  - pushd nanomsg-${nanomsgver}
  - ./configure
  - make
  - make check
  - sudo make install
  - popd
install:
  - cpanm Dist::Zilla
  - dzil authordeps |grep -v '^inc' |cpanm
  # should get this into authordeps somehow
  - cpanm Dist::Zilla::Plugin::MakeMaker::Awesome
  # for the generated optional pod tests that'll otherwise get skipped
  - cpanm Test::Pod Test::Pod::Coverage Pod::Coverage::TrustPod
  - pwd
  - ls -la
  - dzil listdeps |cpanm
script:
  - dzil test --all
